<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Convertisseur Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="./icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f1f5f9; --text: #1e293b; --primary: #4f46e5; --dark: #0f172a; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .font-arabic { font-family: 'Tajawal', sans-serif; }
        
        /* HEADER */
        .header { background: var(--dark); color: white; padding: 15px; padding-top: env(safe-area-inset-top); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .btn-group { background: #1e293b; padding: 4px; border-radius: 8px; display: flex; gap: 4px; }
        .btn-lang { background: transparent; border: none; color: #94a3b8; padding: 5px 10px; border-radius: 6px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 12px; }
        .btn-lang.active { background: var(--primary); color: white; }
        
        /* ECRAN RESULTAT */
        .display-area { background: var(--dark); padding: 20px; text-align: right; border-bottom: 1px solid #1e293b; }
        #input-display { width: 100%; background: transparent; border: none; color: #64748b; font-size: 24px; text-align: right; font-family: monospace; outline: none; }
        #main-display { font-size: 42px; font-weight: bold; color: white; margin: 0; font-family: monospace; overflow-x: auto; white-space: nowrap; }
        .result-card { background: #eef2ff; padding: 15px; flex-shrink: 0; border-bottom: 1px solid #e0e7ff; }
        .template-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 5px; scrollbar-width: none; }
        .btn-template { background: white; border: 1px solid #c7d2fe; color: #6366f1; padding: 6px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; white-space: nowrap; cursor: pointer; }
        .btn-template.active { background: var(--primary); color: white; border-color: var(--primary); }
        .text-result-box { background: white; padding: 15px; border-radius: 12px; min-h: 80px; display: flex; align-items: center; border: 1px solid #e0e7ff; position: relative; }
        #text-result { font-size: 18px; font-weight: 500; line-height: 1.4; color: var(--text); width: 100%; }
        
        /* ACTIONS */
        .copy-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; background: white; }
        .btn-copy { padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 13px; }
        .btn-copy.txt { background: #f1f5f9; color: #475569; }
        .btn-copy.full { background: var(--dark); color: white; }
        
        /* CLAVIER */
        .keypad { flex: 1; background: white; display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 10px; padding-bottom: calc(10px + env(safe-area-inset-bottom)); }
        .key { border: none; background: #f8fafc; border-bottom: 2px solid #e2e8f0; border-radius: 12px; font-size: 22px; font-weight: bold; color: #334155; cursor: pointer; display: flex; align-items: center; justify-content: center; touch-action: manipulation; }
        .key:active { transform: translateY(2px); border-bottom: none; background: #f1f5f9; }
        .key.op { background: #eef2ff; color: var(--primary); border-color: #c7d2fe; }
        .key.del { background: #fef2f2; color: #ef4444; border-color: #fecaca; }

        /* INSTALL BANNER */
        #install-prompt { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 20px; box-shadow: 0 -4px 20px rgba(0,0,0,0.15); z-index: 1000; border-radius: 20px 20px 0 0; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; flex-direction: column; align-items: center; text-align: center; }
        #install-prompt.show { transform: translateY(0); }
        .install-icon { width: 60px; height: 60px; margin-bottom: 10px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .install-title { font-weight: bold; font-size: 18px; margin-bottom: 5px; color: var(--dark); }
        .install-desc { font-size: 14px; color: #64748b; margin-bottom: 15px; max-width: 80%; }
        .install-btn { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 30px; font-weight: bold; font-size: 16px; cursor: pointer; width: 80%; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4); }
        .close-install { color: #94a3b8; background: none; border: none; font-size: 14px; text-decoration: underline; cursor: pointer; padding: 10px; }
        .ios-instruction { display: none; background: #f1f5f9; padding: 10px; border-radius: 8px; font-size: 13px; color: #475569; margin-bottom: 10px; }
        .ios-icon { vertical-align: middle; margin: 0 4px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="btn-group">
            <button class="btn-lang active" onclick="setLang('fr', this)">FR</button>
            <button class="btn-lang" onclick="setLang('en', this)">EN</button>
            <button class="btn-lang" onclick="setLang('ar', this)">AR</button>
        </div>
        <div class="btn-group">
            <button class="btn-lang active" onclick="setMode('currency', this)">DEV</button>
            <button class="btn-lang" onclick="setMode('number', this)">123</button>
        </div>
        <select id="currency-select" onchange="update()" style="background:#1e293b; color:white; border:none; font-weight:bold; outline:none;">
            <option value="DZD">DA</option>
            <option value="EUR">â‚¬</option>
            <option value="USD">$</option>
        </select>
    </div>

    <div class="display-area">
        <input type="text" id="input-display" readonly placeholder="0">
        <div id="main-display">0</div>
    </div>

    <div class="result-card">
        <div class="template-scroll">
            <button class="btn-template active" onclick="setTemplate('none', this)">Aucun</button>
            <button class="btn-template" onclick="setTemplate('check', this)">ChÃ¨que</button>
            <button class="btn-template" onclick="setTemplate('invoice', this)">Facture</button>
            <button class="btn-template" onclick="setTemplate('contract', this)">Contrat</button>
        </div>
        <div class="text-result-box">
            <div id="text-result">...</div>
        </div>
    </div>

    <div class="copy-actions">
        <button class="btn-copy txt" onclick="copyResult('text')">ğŸ“„ <span>TEXTE</span></button>
        <button class="btn-copy full" onclick="copyResult('full')">ğŸ“‹ <span>TOUT</span></button>
    </div>

    <div class="keypad">
        <button class="key op" onclick="press('C')">C</button>
        <button class="key op" onclick="press('(')">(</button>
        <button class="key op" onclick="press(')')">)</button>
        <button class="key op" onclick="press('/')">Ã·</button>
        <button class="key" onclick="press('7')">7</button>
        <button class="key" onclick="press('8')">8</button>
        <button class="key" onclick="press('9')">9</button>
        <button class="key op" onclick="press('*')">Ã—</button>
        <button class="key" onclick="press('4')">4</button>
        <button class="key" onclick="press('5')">5</button>
        <button class="key" onclick="press('6')">6</button>
        <button class="key op" onclick="press('-')">-</button>
        <button class="key" onclick="press('1')">1</button>
        <button class="key" onclick="press('2')">2</button>
        <button class="key" onclick="press('3')">3</button>
        <button class="key op" onclick="press('+')">+</button>
        <button class="key" onclick="press('0')" style="grid-column: span 2">0</button>
        <button class="key" onclick="press('.')">.</button>
        <button class="key del" onclick="press('DEL')">âŒ«</button>
    </div>

    <div id="install-prompt">
        <img src="./icon.png" class="install-icon" alt="Icon">
        <div class="install-title">Installer l'application</div>
        <div class="install-desc">Installez Convertisseur Pro pour un accÃ¨s rapide et hors ligne.</div>
        
        <button id="btn-install" class="install-btn">Installer maintenant</button>
        
        <div id="ios-help" class="ios-instruction">
            Appuyez sur <span style="font-size:18px">â‹</span> (Partager) puis sur<br><strong>"Sur l'Ã©cran d'accueil"</strong> <span style="font-size:18px">âŠ</span>
        </div>

        <button class="close-install" onclick="closeInstall()">Plus tard</button>
    </div>

    <script>
        let state = { expr: '', val: 0, lang: 'fr', cur: 'DZD', mode: 'currency', tpl: 'none' };
        const config = {
            currencies: {
                DZD: { sym: "DA", fr: { n: "dinar", p: "dinars", s: "centime", sp: "centimes" }, en: { n: "dinar", p: "dinars", s: "centime", sp: "centimes" }, ar: { s: "Ø¯ÙŠÙ†Ø§Ø±", d: "Ø¯ÙŠÙ†Ø§Ø±Ø§Ù†", p: "Ø¯Ù†Ø§Ù†ÙŠØ±", def: "Ø¯ÙŠÙ†Ø§Ø±", ss: "Ø³Ù†ØªÙŠÙ…", sd: "Ø³Ù†ØªÙŠÙ…Ø§Ù†", sp: "Ø³Ù†ØªÙŠÙ…Ø§Øª", sdef: "Ø³Ù†ØªÙŠÙ…" } },
                EUR: { sym: "â‚¬", fr: { n: "euro", p: "euros", s: "centime", sp: "centimes" }, en: { n: "euro", p: "euros", s: "cent", sp: "cents" }, ar: { s: "ÙŠÙˆØ±Ùˆ", d: "ÙŠÙˆØ±Ùˆ", p: "ÙŠÙˆØ±Ùˆ", def: "ÙŠÙˆØ±Ùˆ", ss: "Ø³Ù†Øª", sd: "Ø³Ù†ØªØ§Ù†", sp: "Ø³Ù†ØªØ§Øª", sdef: "Ø³Ù†Øª" } },
                USD: { sym: "$", fr: { n: "dollar", p: "dollars", s: "cent", sp: "cents" }, en: { n: "dollar", p: "dollars", s: "cent", sp: "cents" }, ar: { s: "Ø¯ÙˆÙ„Ø§Ø±", d: "Ø¯ÙˆÙ„Ø§Ø±Ø§Ù†", p: "Ø¯ÙˆÙ„Ø§Ø±Ø§Øª", def: "Ø¯ÙˆÙ„Ø§Ø±", ss: "Ø³Ù†Øª", sd: "Ø³Ù†ØªØ§Ù†", sp: "Ø³Ù†ØªØ§Øª", sdef: "Ø³Ù†Øª" } }
            },
            lang: {
                fr: { and: "et", zero: "zÃ©ro", pt: "virgule", tpl: {check: "Payez contre ce chÃ¨que la somme de : ", invoice: "ArrÃªtÃ© la prÃ©sente facture Ã  la somme de : ", contract: "Le montant total s'Ã©lÃ¨ve Ã  : "} },
                en: { and: "and", zero: "zero", pt: "point", tpl: {check: "Pay against this check the sum of: ", invoice: "Total invoice amount fixed at: ", contract: "The total amount is: "} },
                ar: { and: "Ùˆ", zero: "ØµÙØ±", pt: "ÙØ§ØµÙ„", tpl: {check: "Ø§Ø¯ÙØ¹ÙˆØ§ Ø¨Ù…ÙˆØ¬Ø¨ Ù‡Ø°Ø§ Ø§Ù„ØµÙƒ Ù…Ø¨Ù„Øº : ", invoice: "ØªÙˆÙ‚ÙØª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯ Ù…Ø¨Ù„Øº : ", contract: "Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‡Ùˆ : "} }
            }
        };

        function cFr(n){if(n===0)return"";const u=['','un','deux','trois','quatre','cinq','six','sept','huit','neuf'],te=['dix','onze','douze','treize','quatorze','quinze','seize','dix-sept','dix-huit','dix-neuf'],ts=['','dix','vingt','trente','quarante','cinquante','soixante','soixante-dix','quatre-vingt','quatre-vingt-dix'];if(n<10)return u[n];if(n<20)return te[n-10];if(n<100){const t=Math.floor(n/10),r=n%10;if(t===7||t===9){const o=t===7?60:80,p=t===7?"soixante":"quatre-vingt",c=(t===7&&r===1)?" et ":"-";if(n===80)return"quatre-vingts";return p+c+cFr(n-o)}const tw=ts[t];if(r===0)return tw;if(r===1&&t!==8)return tw+" et un";return tw+"-"+u[r]}if(n<1000){if(n===100)return"cent";const h=Math.floor(n/100),r=n%100,hw=(h>1&&r===0)?"cents":"cent",p=h===1?"":u[h]+" ";return p+hw+(r===0?"":" "+cFr(r))}const ch=[{v:1e9,l:"milliard"},{v:1e6,l:"million"},{v:1e3,l:"mille"}];for(let c of ch){if(n>=c.v){const q=Math.floor(n/c.v),r=n%c.v;let l=c.l;if(q>1&&l!=="mille")l+="s";let p=(l==="mille"&&q===1)?"":cFr(q)+" ";return p+l+(r===0?"":" "+cFr(r))}}return"";}
        function cEn(n){const u=['','one','two','three','four','five','six','seven','eight','nine'],t=['','ten','twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety'];if(n===0)return"";if(n<10)return u[n];if(n<20)return['ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen'][n-10];if(n<100)return t[Math.floor(n/10)]+(n%10!==0?"-"+u[n%10]:"");if(n<1000)return u[Math.floor(n/100)]+" hundred"+(n%100!==0?" "+cEn(n%100):"");const ch=[{v:1e9,l:"billion"},{v:1e6,l:"million"},{v:1e3,l:"thousand"}];for(let c of ch)if(n>=c.v)return cEn(Math.floor(n/c.v))+" "+c.l+(n%c.v!==0?", "+cEn(n%c.v):"");}
        function cAr(n){const u=['','ÙˆØ§Ø­Ø¯','Ø§Ø«Ù†Ø§Ù†','Ø«Ù„Ø§Ø«Ø©','Ø£Ø±Ø¨Ø¹Ø©','Ø®Ù…Ø³Ø©','Ø³ØªØ©','Ø³Ø¨Ø¹Ø©','Ø«Ù…Ø§Ù†ÙŠØ©','ØªØ³Ø¹Ø©'],t=['','Ø¹Ø´Ø±Ø©','Ø¹Ø´Ø±ÙˆÙ†','Ø«Ù„Ø§Ø«ÙˆÙ†','Ø£Ø±Ø¨Ø¹ÙˆÙ†','Ø®Ù…Ø³ÙˆÙ†','Ø³ØªÙˆÙ†','Ø³Ø¨Ø¹ÙˆÙ†','Ø«Ù…Ø§Ù†ÙˆÙ†','ØªØ³Ø¹ÙˆÙ†'];if(n===0)return"";if(n<10)return u[n];if(n<20)return['Ø¹Ø´Ø±Ø©','Ø£Ø­Ø¯ Ø¹Ø´Ø±','Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±','Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±','Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±','Ø®Ù…Ø³Ø© Ø¹Ø´Ø±','Ø³ØªØ© Ø¹Ø´Ø±','Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±','Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±','ØªØ³Ø¹Ø© Ø¹Ø´Ø±'][n-10];if(n<100){const r=n%10,d=Math.floor(n/10);return r===0?t[d]:u[r]+" Ùˆ "+t[d]}if(n<1000){const h=Math.floor(n/100),r=n%100;let hw=h===1?"Ù…Ø§Ø¦Ø©":h===2?"Ù…Ø§Ø¦ØªØ§Ù†":u[h]+"Ù…Ø§Ø¦Ø©";return r===0?hw:hw+" Ùˆ "+cAr(r)}const ch=[{v:1e9,l:"Ù…Ù„ÙŠØ§Ø±",d:"Ù…Ù„ÙŠØ§Ø±Ø§Ù†",p:"Ù…Ù„ÙŠØ§Ø±Ø§Øª"},{v:1e6,l:"Ù…Ù„ÙŠÙˆÙ†",d:"Ù…Ù„ÙŠÙˆÙ†Ø§Ù†",p:"Ù…Ù„Ø§ÙŠÙŠÙ†"},{v:1e3,l:"Ø£Ù„Ù",d:"Ø£Ù„ÙØ§Ù†",p:"Ø¢Ù„Ø§Ù"}];for(let c of ch)if(n>=c.v){const q=Math.floor(n/c.v),r=n%c.v;let p="";if(q===1)p=c.l;else if(q===2)p=c.d;else if(q>=3&&q<=10)p=cAr(q)+" "+c.p;else p=cAr(q)+" "+c.l;return r===0?p:p+" Ùˆ "+cAr(r)}}

        function getCurName(v, t, s) { const c=config.currencies[t]; if(state.lang==='ar'){const a=c.ar;return s?(v===1?a.ss:v===2?a.sd:v<=10?a.sp:a.sdef):(v===1?a.s:v===2?a.d:v<=10?a.p:a.def)}const l=c[state.lang];return s?(v>1?l.sp:l.s):(v>1?l.p:l.n)}

        function update() {
            try {
                let clean = state.expr.replace(/[^-()\d/*+.]/g, '');
                let res = clean ? (eval(clean) || 0) : 0;
                res = Math.round(res * 100) / 100;
                if(!isFinite(res)) res=0;
                
                state.val = res;
                document.getElementById('input-display').value = state.expr;
                document.getElementById('main-display').innerHTML = res.toLocaleString('fr') + (state.mode==='currency' ? ` <span style="font-size:0.6em;color:#4ade80">${config.currencies[state.cur].sym}</span>` : '');
                
                let txt = "";
                const intP = Math.floor(res), decP = Math.round((res - intP)*100);
                const cv = state.lang==='fr'?cFr:state.lang==='en'?cEn:cAr;
                const iTxt = intP===0?config.lang[state.lang].zero:cv(intP);
                
                if(state.mode === 'number') {
                    txt = iTxt + (decP>0 ? ` ${config.lang[state.lang].pt} ${cv(decP)}` : '');
                } else {
                    const sep = config.lang[state.lang].and;
                    txt = `${iTxt} ${getCurName(intP, state.cur, false)}`;
                    if(decP > 0) txt += ` ${sep} ${cv(decP)} ${getCurName(decP, state.cur, true)}`;
                }
                
                let finalTxt = txt.charAt(0).toUpperCase() + txt.slice(1);
                if(state.tpl !== 'none') {
                    finalTxt = config.lang[state.lang].tpl[state.tpl] + finalTxt;
                }
                document.getElementById('text-result').innerText = finalTxt;
                
                const isAr = state.lang === 'ar';
                document.body.dir = isAr ? 'rtl' : 'ltr';
                document.body.classList.toggle('font-arabic', isAr);
                
                document.querySelectorAll('.btn-template').forEach(b => {
                   const t = b.innerText;
                   if(t.match(/Aucun|Ù„Ø§ Ø´ÙŠØ¡/)) b.innerText = isAr ? "Ù„Ø§ Ø´ÙŠØ¡" : "Aucun";
                   if(t.match(/ChÃ¨que|Ø´ÙŠÙƒ/)) b.innerText = isAr ? "Ø´ÙŠÙƒ" : "ChÃ¨que";
                   if(t.match(/Facture|ÙØ§ØªÙˆØ±Ø©/)) b.innerText = isAr ? "ÙØ§ØªÙˆØ±Ø©" : "Facture";
                   if(t.match(/Contrat|Ø¹Ù‚Ø¯/)) b.innerText = isAr ? "Ø¹Ù‚Ø¯" : "Contrat";
                });
            } catch(e) {}
        }

        function press(k) {
            if(navigator.vibrate) navigator.vibrate(20);
            if(k==='C') { state.expr=''; }
            else if(k==='DEL') { state.expr=state.expr.slice(0,-1); }
            else { state.expr += k; }
            update();
        }

        function setLang(l, btn) { state.lang = l; document.querySelectorAll('.btn-lang').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); update(); }
        function setMode(m, btn) { state.mode = m; document.getElementById('currency-select').style.display = m==='currency'?'inline-block':'none'; document.querySelectorAll('.btn-group button').forEach(b=> { if(b.onclick && b.onclick.toString().includes('setMode')) b.classList.remove('active')}); btn.classList.add('active'); update(); }
        function setTemplate(t, btn) { state.tpl = t; document.querySelectorAll('.btn-template').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); update(); }
        
        function copyResult(type) {
            let txt = document.getElementById('text-result').innerText;
            if(type === 'full') txt += ` (${state.val} ${config.currencies[state.cur].sym})`;
            navigator.clipboard.writeText(txt).then(() => {
                alert(state.lang==='ar' ? "ØªÙ… Ø§Ù„Ù†Ø³Ø®!" : "CopiÃ© !");
            });
        }

        // --- INSTALLATION SYSTEM ---
        let deferredPrompt;
        const installModal = document.getElementById('install-prompt');
        const installBtn = document.getElementById('btn-install');
        const iosHelp = document.getElementById('ios-help');
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

        if (!isStandalone) {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                setTimeout(() => installModal.classList.add('show'), 2000);
            });

            if (isIOS) {
                setTimeout(() => {
                    installBtn.style.display = 'none'; 
                    iosHelp.style.display = 'block'; 
                    installModal.classList.add('show');
                }, 2000);
            }
        }

        installBtn.addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') { installModal.classList.remove('show'); }
                    deferredPrompt = null;
                });
            }
        });

        function closeInstall() { installModal.classList.remove('show'); }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then(reg => { reg.update(); });
        }
        update();
    </script>
</body>
</html>
